<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timeline Campagne ‚Äì Vizille en Mouvement</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bleu-vizille: #1a3a5c; --bleu-clair: #2d5a87; --or: #c9a227; --or-clair: #e8c84a;
            --blanc-casse: #f8f6f1; --gris-doux: #e8e6e1; --gris-texte: #4a4a4a;
            --vert-fait: #27ae60; --orange-encours: #f39c12; --bleu-afaire: #3498db; --rouge-bloque: #e74c3c;
            /* Couleurs par type */
            --color-evenement: #1abc9c;
            --color-production: #e67e22;
            --color-publication: #9b59b6;
            --color-siteweb: #3498db;
            --color-papier: #e74c3c;
            --color-presse: #34495e;
            --color-email: #c0392b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Source Sans 3', sans-serif; background: var(--blanc-casse); color: var(--gris-texte); }
        
        .header { background: linear-gradient(135deg, var(--bleu-vizille), var(--bleu-clair)); color: white; padding: 1.5rem; }
        .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem; }
        .logo-section { display: flex; align-items: center; gap: 1rem; }
        .logo-icon img { width: 80px; height: auto; }
        .logo-text h1 { font-family: 'Playfair Display', serif; font-size: 1.4rem; }
        .logo-text .slogan { font-size: 0.9rem; color: var(--or-clair); }
        .nav-links { display: flex; gap: 1rem; }
        .nav-links a { color: white; text-decoration: none; padding: 0.5rem 1rem; border-radius: 20px; background: rgba(255,255,255,0.15); transition: all 0.3s; }
        .nav-links a:hover, .nav-links a.active { background: var(--or); color: var(--bleu-vizille); }
        
        .controls { max-width: 1400px; margin: 1.5rem auto; padding: 0 1rem; display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        .filter-group { display: flex; gap: 0.5rem; align-items: center; }
        .filter-group label { font-weight: 600; color: var(--bleu-vizille); }
        .filter-btn { padding: 0.5rem 1rem; border: 2px solid var(--gris-doux); border-radius: 20px; background: white; cursor: pointer; font-family: inherit; transition: all 0.2s; }
        .filter-btn:hover { border-color: var(--bleu-vizille); }
        .filter-btn.active { background: var(--bleu-vizille); color: white; border-color: var(--bleu-vizille); }
        
        .legend { max-width: 1400px; margin: 0 auto 1rem; padding: 0 1rem; display: flex; flex-wrap: wrap; gap: 1rem; }
        .legend-item { display: flex; align-items: center; gap: 0.5rem; font-size: 0.85rem; }
        .legend-dot { width: 16px; height: 16px; border-radius: 4px; }
        
        .timeline-container { max-width: 1400px; margin: 0 auto; padding: 0 1rem 2rem; overflow-x: auto; }
        
        .timeline-header { display: flex; background: var(--bleu-vizille); color: white; border-radius: 12px 12px 0 0; position: sticky; top: 0; z-index: 10; }
        .timeline-header .week-col { flex: 0 0 180px; padding: 0.75rem; text-align: center; border-right: 1px solid rgba(255,255,255,0.2); font-weight: 600; }
        .timeline-header .week-col:last-child { border-right: none; }
        .week-dates { font-size: 0.8rem; opacity: 0.8; font-weight: 400; }
        
        .timeline-body { background: white; border-radius: 0 0 12px 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        
        .timeline-row { display: flex; border-bottom: 1px solid var(--gris-doux); min-height: 60px; }
        .timeline-row:last-child { border-bottom: none; }
        .timeline-row:hover { background: rgba(201, 162, 39, 0.05); }
        
        .week-cell { flex: 0 0 180px; padding: 0.5rem; border-right: 1px solid var(--gris-doux); display: flex; flex-direction: column; gap: 0.25rem; }
        .week-cell:last-child { border-right: none; }
        
        .task-chip { padding: 0.35rem 0.6rem; border-radius: 6px; font-size: 0.75rem; color: white; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 0.3rem; line-height: 1.2; }
        .task-chip:hover { transform: scale(1.02); box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
        .task-chip.evenement { background: var(--color-evenement); }
        .task-chip.production { background: var(--color-production); }
        .task-chip.publication { background: var(--color-publication); }
        .task-chip.siteweb { background: var(--color-siteweb); }
        .task-chip.papier { background: var(--color-papier); }
        .task-chip.presse { background: var(--color-presse); }
        .task-chip.email { background: var(--color-email); }
        
        .task-chip.fait { opacity: 0.5; text-decoration: line-through; }
        .task-chip .task-icon { font-size: 0.9rem; }
        .task-chip .task-text { flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        
        .today-marker { background: rgba(231, 76, 60, 0.1); }
        
        /* Stats summary */
        .stats-summary { max-width: 1400px; margin: 0 auto 1.5rem; padding: 0 1rem; display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
        .stat-card { background: white; padding: 1rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); text-align: center; }
        .stat-card .stat-value { font-family: 'Playfair Display', serif; font-size: 2rem; font-weight: 700; color: var(--bleu-vizille); }
        .stat-card .stat-label { font-size: 0.85rem; color: var(--gris-texte); }
        
        /* Tooltip */
        .tooltip { position: fixed; background: var(--bleu-vizille); color: white; padding: 0.75rem 1rem; border-radius: 8px; font-size: 0.85rem; max-width: 300px; z-index: 1000; pointer-events: none; opacity: 0; transition: opacity 0.2s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        .tooltip.show { opacity: 1; }
        .tooltip .tooltip-title { font-weight: 700; margin-bottom: 0.25rem; }
        .tooltip .tooltip-meta { font-size: 0.75rem; opacity: 0.8; }
        
        @media (max-width: 768px) {
            .header-content { flex-direction: column; text-align: center; }
            .nav-links { justify-content: center; }
            .controls { flex-direction: column; align-items: stretch; }
            .timeline-header .week-col, .week-cell { flex: 0 0 140px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">
                    <img src="https://raw.githubusercontent.com/mich59139/Vizille-en-mouvement2/main/images/logo.png" alt="Logo">
                </div>
                <div class="logo-text">
                    <h1>Vizille en Mouvement</h1>
                    <div class="slogan">Timeline Campagne 2026</div>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">üìã Suivi</a>
                <a href="timeline.html" class="active">üìÖ Timeline</a>
                <a href="aide.html">‚ùì Aide</a>
            </nav>
        </div>
    </header>
    
    <div class="controls">
        <div class="filter-group">
            <label>Filtrer :</label>
            <button class="filter-btn active" data-filter="all">Tout</button>
            <button class="filter-btn" data-filter="evenement">üéâ √âv√©nements</button>
            <button class="filter-btn" data-filter="production">üé¨ Production</button>
            <button class="filter-btn" data-filter="publication">üì± Publications</button>
        </div>
        <div class="filter-group">
            <label>Statut :</label>
            <button class="filter-btn active" data-statut="all">Tous</button>
            <button class="filter-btn" data-statut="afaire">√Ä faire</button>
            <button class="filter-btn" data-statut="fait">Fait</button>
        </div>
    </div>
    
    <div class="legend">
        <div class="legend-item"><div class="legend-dot" style="background: var(--color-evenement)"></div><span>√âv√©nement</span></div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--color-production)"></div><span>Production (tournage, montage)</span></div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--color-publication)"></div><span>Publication FB</span></div>
        <div class="legend-item"><div class="legend-dot" style="background: var(--color-siteweb)"></div><span>Site web</span></div>
    </div>
    
    <div class="stats-summary" id="stats-summary"></div>
    
    <div class="timeline-container">
        <div class="timeline-header" id="timeline-header"></div>
        <div class="timeline-body" id="timeline-body"></div>
    </div>
    
    <div class="tooltip" id="tooltip"></div>
    
    <script>
        let allTasks = [];
        let currentFilter = 'all';
        let currentStatut = 'all';
        
        // Charger les donn√©es
        async function loadData() {
            try {
                const response = await fetch('https://raw.githubusercontent.com/mich59139/suivi/main/data/communication.json');
                allTasks = await response.json();
                render();
            } catch (e) {
                console.error('Erreur chargement', e);
            }
        }
        
        // D√©terminer le type de t√¢che
        function getTaskType(task) {
            const axe = task.axe || '';
            const categorie = (task.categorie || '').toLowerCase();
            const tache = (task.tache || '').toLowerCase();
            
            if (axe === '√âv√©nementiel') return 'evenement';
            if (axe === 'Production' || categorie === 'vid√©o' || categorie.includes('terrain')) return 'production';
            if (categorie.includes('publication') || categorie.includes('fb')) return 'publication';
            if (axe === 'Site web') return 'siteweb';
            if (axe === 'Supports papier') return 'papier';
            if (axe === 'Presse') return 'presse';
            if (axe === 'Email') return 'email';
            if (axe === 'R√©seaux sociaux') return 'publication';
            return 'production';
        }
        
        // Ic√¥ne par type
        function getTypeIcon(type) {
            const icons = {
                evenement: 'üéâ',
                production: 'üé¨',
                publication: 'üì±',
                siteweb: 'üåê',
                papier: 'üìÑ',
                presse: 'üì∞',
                email: '‚úâÔ∏è'
            };
            return icons[type] || 'üìå';
        }
        
        // G√©n√©rer les semaines (12 jan ‚Üí 16 mars 2026)
        function generateWeeks() {
            const weeks = [];
            const start = new Date('2026-01-12');
            const end = new Date('2026-03-22');
            
            let current = new Date(start);
            while (current <= end) {
                const weekStart = new Date(current);
                const weekEnd = new Date(current);
                weekEnd.setDate(weekEnd.getDate() + 6);
                
                weeks.push({
                    start: weekStart,
                    end: weekEnd,
                    label: `Sem. ${weeks.length + 1}`,
                    dates: `${weekStart.getDate()}/${weekStart.getMonth()+1} - ${weekEnd.getDate()}/${weekEnd.getMonth()+1}`
                });
                
                current.setDate(current.getDate() + 7);
            }
            return weeks;
        }
        
        // Filtrer les t√¢ches
        function filterTasks() {
            return allTasks.filter(task => {
                const type = getTaskType(task);
                const typeMatch = currentFilter === 'all' || type === currentFilter;
                const statutMatch = currentStatut === 'all' || 
                    (currentStatut === 'fait' && task.statut === 'Fait') ||
                    (currentStatut === 'afaire' && task.statut !== 'Fait');
                return typeMatch && statutMatch;
            });
        }
        
        // Render
        function render() {
            const weeks = generateWeeks();
            const tasks = filterTasks();
            const today = new Date();
            
            // Stats
            const stats = {
                total: tasks.length,
                evenements: tasks.filter(t => getTaskType(t) === 'evenement').length,
                production: tasks.filter(t => getTaskType(t) === 'production').length,
                publications: tasks.filter(t => getTaskType(t) === 'publication').length,
                fait: tasks.filter(t => t.statut === 'Fait').length
            };
            
            document.getElementById('stats-summary').innerHTML = `
                <div class="stat-card"><div class="stat-value">${stats.total}</div><div class="stat-label">Total t√¢ches</div></div>
                <div class="stat-card"><div class="stat-value">${stats.evenements}</div><div class="stat-label">üéâ √âv√©nements</div></div>
                <div class="stat-card"><div class="stat-value">${stats.production}</div><div class="stat-label">üé¨ Production</div></div>
                <div class="stat-card"><div class="stat-value">${stats.publications}</div><div class="stat-label">üì± Publications</div></div>
                <div class="stat-card"><div class="stat-value">${stats.fait}</div><div class="stat-label">‚úÖ Termin√©es</div></div>
            `;
            
            // Header semaines
            document.getElementById('timeline-header').innerHTML = weeks.map(w => `
                <div class="week-col">
                    <div>${w.label}</div>
                    <div class="week-dates">${w.dates}</div>
                </div>
            `).join('');
            
            // Grouper les t√¢ches par semaine
            const tasksByWeek = {};
            weeks.forEach((w, i) => tasksByWeek[i] = []);
            
            tasks.forEach(task => {
                if (!task.echeance) return;
                const taskDate = new Date(task.echeance);
                
                for (let i = 0; i < weeks.length; i++) {
                    if (taskDate >= weeks[i].start && taskDate <= weeks[i].end) {
                        tasksByWeek[i].push(task);
                        break;
                    }
                }
            });
            
            // Calculer le nombre max de t√¢ches par semaine
            const maxTasks = Math.max(...Object.values(tasksByWeek).map(t => t.length), 1);
            
            // G√©n√©rer les lignes (une ligne par "slot")
            let bodyHtml = '';
            for (let row = 0; row < maxTasks; row++) {
                bodyHtml += '<div class="timeline-row">';
                for (let weekIdx = 0; weekIdx < weeks.length; weekIdx++) {
                    const weekTasks = tasksByWeek[weekIdx];
                    const task = weekTasks[row];
                    
                    const isToday = today >= weeks[weekIdx].start && today <= weeks[weekIdx].end;
                    
                    bodyHtml += `<div class="week-cell ${isToday ? 'today-marker' : ''}">`;
                    if (task) {
                        const type = getTaskType(task);
                        const icon = getTypeIcon(type);
                        const isFait = task.statut === 'Fait';
                        bodyHtml += `
                            <div class="task-chip ${type} ${isFait ? 'fait' : ''}" 
                                 data-id="${task.id}"
                                 data-title="${task.tache}"
                                 data-date="${task.echeance}"
                                 data-responsable="${task.responsable}"
                                 data-statut="${task.statut}">
                                <span class="task-icon">${icon}</span>
                                <span class="task-text">${task.tache}</span>
                            </div>
                        `;
                    }
                    bodyHtml += '</div>';
                }
                bodyHtml += '</div>';
            }
            
            document.getElementById('timeline-body').innerHTML = bodyHtml || '<div style="padding:2rem;text-align:center;">Aucune t√¢che</div>';
            
            // Tooltips
            document.querySelectorAll('.task-chip').forEach(chip => {
                chip.addEventListener('mouseenter', showTooltip);
                chip.addEventListener('mouseleave', hideTooltip);
                chip.addEventListener('click', () => {
                    window.location.href = `index.html?edit=${chip.dataset.id}`;
                });
            });
        }
        
        // Tooltip
        function showTooltip(e) {
            const chip = e.target.closest('.task-chip');
            const tooltip = document.getElementById('tooltip');
            const date = new Date(chip.dataset.date).toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
            
            tooltip.innerHTML = `
                <div class="tooltip-title">${chip.dataset.title}</div>
                <div class="tooltip-meta">üìÖ ${date}</div>
                <div class="tooltip-meta">üë§ ${chip.dataset.responsable} ‚Ä¢ ${chip.dataset.statut}</div>
            `;
            
            const rect = chip.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 8) + 'px';
            tooltip.classList.add('show');
        }
        
        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('show');
        }
        
        // Event listeners filtres
        document.querySelectorAll('.filter-btn[data-filter]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn[data-filter]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentFilter = btn.dataset.filter;
                render();
            });
        });
        
        document.querySelectorAll('.filter-btn[data-statut]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn[data-statut]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentStatut = btn.dataset.statut;
                render();
            });
        });
        
        // Init
        loadData();
    </script>
</body>
</html>
