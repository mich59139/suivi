<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suivi Communication ‚Äì Vizille en Mouvement</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Source+Sans+3:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
    
    <style>
        :root {
            --bleu-vizille: #1a3a5c; --bleu-clair: #2d5a87; --or: #c9a227; --or-clair: #e8c84a;
            --blanc-casse: #f8f6f1; --gris-doux: #e8e6e1; --gris-texte: #4a4a4a;
            --vert-fait: #27ae60; --orange-encours: #f39c12; --bleu-afaire: #3498db; --rouge-bloque: #e74c3c; --violet-haute: #9b59b6;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.08); --shadow-md: 0 4px 12px rgba(0,0,0,0.12); --shadow-lg: 0 8px 24px rgba(0,0,0,0.16);
            --radius-sm: 8px; --radius-md: 12px; --radius-lg: 20px;
            /* Couleurs par TYPE d'action */
            --type-evenement: #1abc9c;
            --type-production: #e67e22;
            --type-publication: #9b59b6;
            --type-siteweb: #3498db;
            --type-papier: #e74c3c;
            --type-terrain: #27ae60;
            --type-presse: #34495e;
            --type-email: #c0392b;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Source Sans 3', -apple-system, BlinkMacSystemFont, sans-serif; background: var(--blanc-casse); color: var(--gris-texte); line-height: 1.6; }
        
        .header { background: linear-gradient(135deg, var(--bleu-vizille) 0%, var(--bleu-clair) 100%); color: white; padding: 1.5rem; position: relative; overflow: hidden; }
        .header::before { content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E"); opacity: 0.5; }
        .header-content { max-width: 1200px; margin: 0 auto; position: relative; z-index: 1; }
        .header-top { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem; }
        .logo-section { display: flex; align-items: center; gap: 1rem; }
        .logo-icon { width: 120px; height: auto; }
        .logo-icon img { width: 100%; height: auto; }
        .logo-text h1 { font-family: 'Playfair Display', serif; font-size: 1.5rem; font-weight: 700; }
        .logo-text .slogan { font-size: 0.95rem; color: var(--or-clair); font-weight: 600; }
        .page-title { background: rgba(255,255,255,0.15); padding: 0.5rem 1.25rem; border-radius: 30px; border: 1px solid rgba(255,255,255,0.3); font-weight: 600; display: flex; align-items: center; gap: 0.5rem; }
        
        .stats-bar { display: flex; flex-wrap: wrap; gap: 0.75rem; margin-top: 1.25rem; justify-content: center; }
        .stat-chip { background: rgba(255,255,255,0.12); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); border-radius: 25px; padding: 0.5rem 1rem; display: flex; align-items: center; gap: 0.5rem; font-size: 0.9rem; transition: all 0.3s ease; cursor: pointer; }
        .stat-chip:hover { background: rgba(255,255,255,0.2); transform: translateY(-2px); }
        .stat-chip.active { background: var(--or); color: var(--bleu-vizille); font-weight: 600; }
        .stat-number { font-family: 'Playfair Display', serif; font-weight: 700; font-size: 1.1rem; }
        .stat-chip.afaire .stat-number { color: var(--bleu-afaire); }
        .stat-chip.encours .stat-number { color: var(--orange-encours); }
        .stat-chip.bloque .stat-number { color: var(--rouge-bloque); }
        .stat-chip.fait .stat-number { color: var(--vert-fait); }
        .stat-chip.haute .stat-number { color: var(--violet-haute); }
        .stat-chip.active .stat-number { color: var(--bleu-vizille); }
        
        .toolbar { max-width: 1200px; margin: 1.5rem auto; padding: 0 1rem; display: flex; flex-wrap: wrap; gap: 0.75rem; align-items: center; }
        .search-box { flex: 1; min-width: 200px; position: relative; }
        .search-box input { width: 100%; padding: 0.75rem 1rem 0.75rem 2.75rem; border: 2px solid var(--gris-doux); border-radius: var(--radius-md); font-size: 1rem; font-family: inherit; background: white; transition: all 0.3s ease; }
        .search-box input:focus { outline: none; border-color: var(--bleu-vizille); box-shadow: 0 0 0 3px rgba(26, 58, 92, 0.1); }
        .search-box::before { content: 'üîç'; position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); font-size: 1rem; opacity: 0.5; }
        .filter-select { padding: 0.75rem 2rem 0.75rem 1rem; border: 2px solid var(--gris-doux); border-radius: var(--radius-md); font-size: 0.95rem; font-family: inherit; background: white url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234a4a4a' d='M6 8L1 3h10z'/%3E%3C/svg%3E") no-repeat right 0.75rem center; appearance: none; cursor: pointer; min-width: 140px; }
        .filter-select:focus { outline: none; border-color: var(--bleu-vizille); }
        
        /* Toggle vues am√©lior√© */
        .view-toggle { display: flex; background: var(--gris-doux); border-radius: var(--radius-md); overflow: hidden; }
        .view-btn { padding: 0.6rem 0.9rem; border: none; background: transparent; cursor: pointer; font-size: 0.85rem; transition: all 0.2s ease; display: flex; align-items: center; gap: 0.3rem; }
        .view-btn.active { background: var(--bleu-vizille); color: white; }
        .view-btn:hover:not(.active) { background: rgba(26, 58, 92, 0.1); }
        
        .btn-action { padding: 0.75rem 1.25rem; border: none; border-radius: var(--radius-md); font-size: 0.95rem; font-family: inherit; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: all 0.3s ease; }
        .btn-primary { background: linear-gradient(135deg, var(--or) 0%, var(--or-clair) 100%); color: var(--bleu-vizille); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-secondary { background: white; color: var(--bleu-vizille); border: 2px solid var(--gris-doux); }
        .btn-secondary:hover { border-color: var(--bleu-vizille); }
        .btn-team { background: var(--bleu-clair); color: white; border: none; }
        .btn-team:hover { background: var(--bleu-vizille); }
        .btn-group { background: var(--violet-haute); color: white; border: none; }
        .btn-group:hover { background: #8e44ad; }
        .btn-alert { background: var(--rouge-bloque); color: white; border: none; }
        .btn-alert:hover { background: #c0392b; }
        .btn-github { background: #24292e; color: white; border: none; }
        .btn-github:hover { background: #1a1e22; }
        .btn-github.connected { background: var(--vert-fait); }
        
        .sync-indicator { position: fixed; bottom: 20px; right: 20px; background: var(--bleu-vizille); color: white; padding: 0.75rem 1.25rem; border-radius: var(--radius-md); box-shadow: var(--shadow-lg); display: none; align-items: center; gap: 0.5rem; z-index: 1000; font-weight: 500; }
        .sync-indicator.show { display: flex; animation: slideIn 0.3s ease; }
        .sync-indicator.success { background: var(--vert-fait); }
        .sync-indicator.error { background: var(--rouge-bloque); }
        .sync-indicator.warning { background: #f39c12; }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        /* ===== CONTENEURS DE VUES ===== */
        .view-container { max-width: 1200px; margin: 0 auto; padding: 0 1rem 2rem; display: none; }
        .view-container.active { display: block; }
        
        /* ===== VUE GROUP√âE PAR AXE ===== */
        .axe-group { margin-bottom: 1.5rem; border-radius: var(--radius-lg); overflow: hidden; box-shadow: var(--shadow-sm); }
        .axe-header { padding: 1rem 1.5rem; display: flex; align-items: center; justify-content: space-between; cursor: pointer; transition: all 0.2s ease; color: white; }
        .axe-header:hover { filter: brightness(1.1); }
        .axe-header.siteweb { background: linear-gradient(135deg, #3498db 0%, #2980b9 100%); }
        .axe-header.reseaux { background: linear-gradient(135deg, #9b59b6 0%, #8e44ad 100%); }
        .axe-header.papier { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); }
        .axe-header.evenementiel { background: linear-gradient(135deg, #1abc9c 0%, #16a085 100%); }
        .axe-header.production { background: linear-gradient(135deg, #e67e22 0%, #d35400 100%); }
        .axe-header.presse { background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%); }
        .axe-header.email { background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); }
        .axe-title { display: flex; align-items: center; gap: 0.75rem; }
        .axe-icon { font-size: 1.5rem; }
        .axe-name { font-family: 'Playfair Display', serif; font-size: 1.2rem; font-weight: 700; }
        .axe-count { background: rgba(255,255,255,0.25); padding: 0.2rem 0.6rem; border-radius: 12px; font-size: 0.85rem; font-weight: 600; margin-left: 0.5rem; }
        .axe-stats { display: flex; gap: 1rem; align-items: center; }
        .axe-stat { display: flex; align-items: center; gap: 0.3rem; font-size: 0.85rem; opacity: 0.9; }
        .axe-stat-dot { width: 10px; height: 10px; border-radius: 50%; }
        .axe-stat-dot.afaire { background: #3498db; }
        .axe-stat-dot.encours { background: #f39c12; }
        .axe-stat-dot.fait { background: #27ae60; }
        .axe-stat-dot.bloque { background: #e74c3c; }
        .axe-toggle { font-size: 1.25rem; transition: transform 0.3s ease; }
        .axe-group.collapsed .axe-toggle { transform: rotate(-90deg); }
        .axe-content { background: white; padding: 1rem; display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem; }
        .axe-group.collapsed .axe-content { display: none; }
        
        /* ===== CARTES AVEC BORDURE TYPE ===== */
        .action-card { background: var(--blanc-casse); border-radius: var(--radius-md); box-shadow: var(--shadow-sm); overflow: hidden; cursor: pointer; transition: all 0.3s ease; border-left: 5px solid #ccc; }
        .action-card:hover { transform: translateY(-3px); box-shadow: var(--shadow-md); }
        .action-card.type-evenement { border-left-color: var(--type-evenement); }
        .action-card.type-production { border-left-color: var(--type-production); }
        .action-card.type-publication { border-left-color: var(--type-publication); }
        .action-card.type-siteweb { border-left-color: var(--type-siteweb); }
        .action-card.type-papier { border-left-color: var(--type-papier); }
        .action-card.type-terrain { border-left-color: var(--type-terrain); }
        .action-card.type-presse { border-left-color: var(--type-presse); }
        .action-card.type-email { border-left-color: var(--type-email); }
        
        .card-header { padding: 0.75rem 1rem; display: flex; justify-content: space-between; align-items: flex-start; gap: 0.5rem; }
        .card-id { font-family: 'Playfair Display', serif; font-size: 0.8rem; font-weight: 700; color: var(--bleu-vizille); background: white; padding: 0.15rem 0.5rem; border-radius: 4px; }
        .card-badges { display: flex; gap: 0.4rem; flex-wrap: wrap; }
        .badge { font-size: 0.7rem; padding: 0.15rem 0.5rem; border-radius: 12px; font-weight: 600; }
        .badge-statut { color: white; }
        .badge-statut.afaire { background: var(--bleu-afaire); }
        .badge-statut.encours { background: var(--orange-encours); }
        .badge-statut.bloque { background: var(--rouge-bloque); }
        .badge-statut.fait { background: var(--vert-fait); }
        .badge-priorite { background: rgba(155, 89, 182, 0.15); color: var(--violet-haute); }
        .badge-type { font-size: 0.65rem; padding: 0.1rem 0.4rem; border-radius: 4px; color: white; }
        .badge-type.evenement { background: var(--type-evenement); }
        .badge-type.production { background: var(--type-production); }
        .badge-type.publication { background: var(--type-publication); }
        .badge-type.siteweb { background: var(--type-siteweb); }
        .badge-type.terrain { background: var(--type-terrain); }
        
        .card-body { padding: 0 1rem 0.75rem; }
        .card-title { font-weight: 600; color: var(--bleu-vizille); margin-bottom: 0.25rem; font-size: 0.95rem; line-height: 1.3; }
        .card-description { font-size: 0.85rem; color: var(--gris-texte); opacity: 0.8; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .card-footer { padding: 0.5rem 1rem; background: white; display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; border-top: 1px solid var(--gris-doux); }
        .card-meta { display: flex; align-items: center; gap: 0.4rem; color: var(--gris-texte); }
        .card-echeance { font-size: 0.75rem; color: var(--gris-texte); }
        .card-echeance.urgent { color: var(--rouge-bloque); font-weight: 600; }
        
        /* ===== VUE KANBAN ===== */
        .kanban-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1rem; }
        .kanban-column { background: white; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); overflow: hidden; min-height: 400px; }
        .kanban-header { padding: 1rem; color: white; font-family: 'Playfair Display', serif; font-weight: 700; text-align: center; }
        .kanban-header.afaire { background: var(--bleu-afaire); }
        .kanban-header.encours { background: var(--orange-encours); }
        .kanban-header.bloque { background: var(--rouge-bloque); }
        .kanban-header.fait { background: var(--vert-fait); }
        .kanban-header .count { background: rgba(255,255,255,0.3); padding: 0.2rem 0.5rem; border-radius: 10px; font-size: 0.85rem; margin-left: 0.5rem; }
        .kanban-body { padding: 0.75rem; display: flex; flex-direction: column; gap: 0.75rem; max-height: 600px; overflow-y: auto; }
        .kanban-card { background: var(--blanc-casse); border-radius: var(--radius-sm); padding: 0.75rem; cursor: pointer; transition: all 0.2s; border-left: 4px solid #ccc; }
        .kanban-card:hover { transform: scale(1.02); box-shadow: var(--shadow-sm); }
        .kanban-card.type-evenement { border-left-color: var(--type-evenement); }
        .kanban-card.type-production { border-left-color: var(--type-production); }
        .kanban-card.type-publication { border-left-color: var(--type-publication); }
        .kanban-card.type-siteweb { border-left-color: var(--type-siteweb); }
        .kanban-card.type-terrain { border-left-color: var(--type-terrain); }
        .kanban-card-title { font-weight: 600; font-size: 0.85rem; color: var(--bleu-vizille); margin-bottom: 0.25rem; }
        .kanban-card-meta { font-size: 0.75rem; color: var(--gris-texte); display: flex; justify-content: space-between; }
        
        /* ===== VUE TIMELINE SIMPLIFI√âE ===== */
        .timeline-mini { background: white; border-radius: var(--radius-lg); padding: 1.5rem; box-shadow: var(--shadow-sm); }
        .timeline-week { margin-bottom: 1.5rem; }
        .timeline-week-header { display: flex; align-items: center; gap: 1rem; margin-bottom: 0.75rem; padding-bottom: 0.5rem; border-bottom: 2px solid var(--gris-doux); }
        .timeline-week-label { font-family: 'Playfair Display', serif; font-weight: 700; color: var(--bleu-vizille); min-width: 100px; }
        .timeline-week-dates { font-size: 0.85rem; color: var(--gris-texte); }
        .timeline-tasks { display: flex; flex-wrap: wrap; gap: 0.5rem; }
        .timeline-task { padding: 0.4rem 0.75rem; border-radius: 20px; font-size: 0.8rem; color: white; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 0.3rem; }
        .timeline-task:hover { transform: scale(1.05); }
        .timeline-task.evenement { background: var(--type-evenement); }
        .timeline-task.production { background: var(--type-production); }
        .timeline-task.publication { background: var(--type-publication); }
        .timeline-task.siteweb { background: var(--type-siteweb); }
        .timeline-task.terrain { background: var(--type-terrain); }
        .timeline-task.fait { opacity: 0.5; text-decoration: line-through; }
        
        /* L√©gende types */
        .type-legend { max-width: 1200px; margin: 0 auto 1rem; padding: 0 1rem; display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        .type-legend-title { font-weight: 600; color: var(--bleu-vizille); }
        .type-legend-item { display: flex; align-items: center; gap: 0.4rem; font-size: 0.85rem; }
        .type-legend-dot { width: 12px; height: 12px; border-radius: 3px; }
        
        /* Chart */
        .chart-section { max-width: 1200px; margin: 0 auto 1.5rem; padding: 0 1rem; }
        .chart-card { background: white; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); padding: 1.5rem; }
        .chart-card h3 { font-family: 'Playfair Display', serif; color: var(--bleu-vizille); margin-bottom: 1rem; text-align: center; }
        .chart-container { display: flex; gap: 2rem; align-items: center; flex-wrap: wrap; }
        .chart-wrapper { flex: 1; min-width: 200px; max-width: 300px; margin: 0 auto; }
        .chart-legend { flex: 1; min-width: 200px; }
        .legend-item { display: flex; align-items: center; gap: 0.75rem; padding: 0.5rem; border-radius: var(--radius-sm); cursor: pointer; }
        .legend-item:hover { background: var(--blanc-casse); }
        .legend-color { width: 16px; height: 16px; border-radius: 4px; }
        .legend-label { flex: 1; font-weight: 500; }
        .legend-value { font-family: 'Playfair Display', serif; font-weight: 700; color: var(--bleu-vizille); }
        
        .empty-state { text-align: center; padding: 4rem 2rem; color: var(--gris-texte); background: white; border-radius: var(--radius-lg); }
        .empty-state-icon { font-size: 4rem; opacity: 0.3; margin-bottom: 1rem; }
        .empty-state h3 { font-family: 'Playfair Display', serif; color: var(--bleu-vizille); }
        
        .floating-buttons { position: fixed; bottom: 20px; left: 20px; display: flex; flex-direction: column; gap: 12px; z-index: 999; }
        .float-btn { width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; text-decoration: none; box-shadow: 0 4px 15px rgba(0,0,0,0.2); transition: all 0.3s ease; cursor: pointer; }
        .float-btn:hover { transform: scale(1.1); }
        .help-btn { background: var(--or); color: var(--bleu-vizille); font-size: 1.5rem; font-weight: 700; }
        .whatsapp-float { background: #25D366; color: white; }
        .whatsapp-float svg { width: 28px; height: 28px; }
        
        @media (max-width: 1024px) {
            .kanban-container { grid-template-columns: repeat(2, 1fr); }
        }
        @media (max-width: 768px) {
            .header-top, .logo-section { flex-direction: column; text-align: center; }
            .toolbar { flex-direction: column; }
            .search-box { width: 100%; }
            .axe-content { grid-template-columns: 1fr; }
            .kanban-container { grid-template-columns: 1fr; }
            .axe-stats { display: none; }
            .view-toggle { flex-wrap: wrap; justify-content: center; }
        }

        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(26, 58, 92, 0.8); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s ease; padding: 1rem; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: var(--radius-lg); width: 100%; max-width: 600px; max-height: 90vh; overflow: hidden; transform: translateY(20px) scale(0.95); transition: transform 0.3s ease; display: flex; flex-direction: column; }
        .modal-overlay.active .modal { transform: translateY(0) scale(1); }
        .modal-header { background: linear-gradient(135deg, var(--bleu-vizille) 0%, var(--bleu-clair) 100%); color: white; padding: 1.25rem 1.5rem; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-family: 'Playfair Display', serif; font-size: 1.25rem; display: flex; align-items: center; gap: 0.5rem; }
        .modal-close { background: rgba(255,255,255,0.2); border: none; color: white; width: 36px; height: 36px; border-radius: 50%; font-size: 1.25rem; cursor: pointer; }
        .modal-body { padding: 1.5rem; overflow-y: auto; flex: 1; }
        .form-group { margin-bottom: 1.25rem; }
        .form-group label { display: block; font-weight: 600; color: var(--bleu-vizille); margin-bottom: 0.5rem; font-size: 0.9rem; }
        .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem 1rem; border: 2px solid var(--gris-doux); border-radius: var(--radius-sm); font-size: 1rem; font-family: inherit; }
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus { outline: none; border-color: var(--bleu-vizille); }
        .form-group textarea { min-height: 100px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        .modal-footer { padding: 1rem 1.5rem; background: var(--blanc-casse); display: flex; justify-content: space-between; gap: 1rem; flex-wrap: wrap; }
        .btn-delete { background: var(--rouge-bloque); color: white; }
        .btn-save { background: linear-gradient(135deg, var(--vert-fait) 0%, #2ecc71 100%); color: white; }
        .btn-cancel { background: white; color: var(--gris-texte); border: 2px solid var(--gris-doux); padding: 0.75rem 1.25rem; border-radius: var(--radius-md); font-size: 0.95rem; font-family: inherit; font-weight: 600; cursor: pointer; }
        
        .member-list { list-style: none; max-height: 400px; overflow-y: auto; }
        .member-item { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem 1rem; background: var(--blanc-casse); border-radius: var(--radius-sm); margin-bottom: 0.5rem; }
        .member-info { flex: 1; }
        .member-name { font-weight: 600; color: var(--bleu-vizille); display: flex; align-items: center; gap: 0.5rem; }
        .member-name::before { content: 'üë§'; }
        .member-contact { font-size: 0.85rem; color: var(--gris-texte); margin-top: 0.25rem; }
        .member-contact a { color: var(--bleu-clair); text-decoration: none; }
        .btn-remove-member { background: transparent; border: none; color: var(--rouge-bloque); font-size: 1.25rem; cursor: pointer; }
        .add-member-form { display: grid; grid-template-columns: 1fr auto; gap: 0.5rem; margin-top: 1rem; padding-top: 1rem; border-top: 2px solid var(--gris-doux); }
        .add-member-form input { padding: 0.75rem 1rem; border: 2px solid var(--gris-doux); border-radius: var(--radius-sm); font-size: 0.9rem; font-family: inherit; }
        .btn-add-member { background: var(--vert-fait); color: white; border: none; padding: 0.75rem 1rem; border-radius: var(--radius-sm); font-size: 1rem; cursor: pointer; }
        .count-info { text-align: center; color: var(--gris-texte); font-size: 0.9rem; margin-bottom: 1rem; }
        .count-info strong { color: var(--bleu-vizille); font-family: 'Playfair Display', serif; }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="header-top">
                <div class="logo-section">
                    <div class="logo-icon">
                        <img src="https://raw.githubusercontent.com/mich59139/Vizille-en-mouvement2/main/images/logo.png" alt="Vizille en Mouvement">
                    </div>
                    <div class="logo-text">
                        <h1>Vizille en Mouvement</h1>
                        <div class="slogan">Ensemble pour une ville dynamique et solidaire</div>
                    </div>
                </div>
                <div class="page-title"><span>üìã</span><span>Suivi Communication</span></div>
            </div>
            <div class="stats-bar" id="stats-bar"></div>
        </div>
    </header>
    
    <div class="toolbar">
        <div class="search-box"><input type="text" id="search-input" placeholder="Rechercher une action..."></div>
        <select class="filter-select" id="filter-responsable"><option value="">Tous responsables</option></select>
        <select class="filter-select" id="filter-statut">
            <option value="">Tous statuts</option>
            <option value="√Ä faire">√Ä faire</option>
            <option value="En cours">En cours</option>
            <option value="Bloqu√©">Bloqu√©</option>
            <option value="Fait">Fait</option>
        </select>
        <div class="view-toggle">
            <button class="view-btn active" data-view="grouped" title="Par axe">üìÅ Axes</button>
            <button class="view-btn" data-view="types" title="Par type">üé® Types</button>
            <button class="view-btn" data-view="kanban" title="Kanban">üìä Kanban</button>
            <button class="view-btn" data-view="timeline" title="Timeline">üìÖ Timeline</button>
        </div>
        <button class="btn-action btn-primary" id="btn-new"><span>‚ûï</span><span>Nouvelle</span></button>
        <button class="btn-action btn-team" id="btn-team"><span>üë•</span><span>√âquipe</span></button>
        <button class="btn-action btn-secondary" id="btn-export"><span>üì•</span><span>CSV</span></button>
        <button class="btn-action btn-github" id="btn-github"><span>‚öôÔ∏è</span><span id="github-status">GitHub</span></button>
    </div>
    
    <!-- L√©gende des types -->
    <div class="type-legend">
        <span class="type-legend-title">Types :</span>
        <div class="type-legend-item"><div class="type-legend-dot" style="background: var(--type-evenement)"></div><span>üéâ √âv√©nement</span></div>
        <div class="type-legend-item"><div class="type-legend-dot" style="background: var(--type-production)"></div><span>üé¨ Production</span></div>
        <div class="type-legend-item"><div class="type-legend-dot" style="background: var(--type-publication)"></div><span>üì± Publication</span></div>
        <div class="type-legend-item"><div class="type-legend-dot" style="background: var(--type-siteweb)"></div><span>üåê Site web</span></div>
        <div class="type-legend-item"><div class="type-legend-dot" style="background: var(--type-terrain)"></div><span>üö∂ Terrain</span></div>
    </div>
    
    <div class="chart-section"><div class="chart-card"><h3>üìä R√©partition par statut</h3><div class="chart-container"><div class="chart-wrapper"><canvas id="statusChart"></canvas></div><div class="chart-legend" id="chart-legend"></div></div></div></div>
    
    <!-- Vue group√©e par axe -->
    <div class="view-container active" id="grouped-container"></div>
    
    <!-- Vue group√©e par type -->
    <div class="view-container" id="types-container"></div>
    
    <!-- Vue Kanban -->
    <div class="view-container" id="kanban-container"></div>
    
    <!-- Vue Timeline -->
    <div class="view-container" id="timeline-container"></div>
    
    <!-- MODALS -->
    <div class="modal-overlay" id="modal-overlay">
        <div class="modal">
            <div class="modal-header"><h2><span id="modal-icon">üìù</span> <span id="modal-title">Action</span></h2><button class="modal-close" id="modal-close">√ó</button></div>
            <div class="modal-body">
                <form id="action-form">
                    <input type="hidden" id="form-id">
                    <div class="form-row">
                        <div class="form-group"><label>Axe</label><select id="form-axe"><option value="Site web">üåê Site web</option><option value="R√©seaux sociaux">üì± R√©seaux sociaux</option><option value="Supports papier">üìÑ Supports papier</option><option value="√âv√©nementiel">üéâ √âv√©nementiel</option><option value="Production">üé¨ Production</option><option value="Presse">üì∞ Presse</option><option value="Email">‚úâÔ∏è Email</option></select></div>
                        <div class="form-group"><label>Cat√©gorie</label><select id="form-categorie"></select></div>
                    </div>
                    <div class="form-group"><label>T√¢che</label><input type="text" id="form-tache" required></div>
                    <div class="form-group"><label>Description</label><textarea id="form-description"></textarea></div>
                    <div class="form-row">
                        <div class="form-group"><label>Responsable</label><select id="form-responsable"></select></div>
                        <div class="form-group"><label>Statut</label><select id="form-statut"><option value="√Ä faire">√Ä faire</option><option value="En cours">En cours</option><option value="Bloqu√©">Bloqu√©</option><option value="Fait">Fait</option></select></div>
                    </div>
                    <div class="form-row">
                        <div class="form-group"><label>Priorit√©</label><select id="form-priorite"><option value="Basse">Basse</option><option value="Moyenne">Moyenne</option><option value="Haute">Haute</option></select></div>
                        <div class="form-group"><label>√âch√©ance</label><input type="date" id="form-echeance"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer"><button class="btn-action btn-delete" id="btn-delete" style="display:none"><span>üóëÔ∏è</span><span>Supprimer</span></button><div style="flex:1"></div><button class="btn-cancel" id="btn-cancel">Annuler</button><button class="btn-action btn-save" id="btn-save"><span>‚úì</span><span>Enregistrer</span></button></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="team-modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h2>üë• √âquipe Communication</h2><button class="modal-close" id="team-modal-close">√ó</button></div>
            <div class="modal-body">
                <div class="count-info"><strong id="team-count">0</strong> membres</div>
                <ul class="member-list" id="team-list"></ul>
                <div class="add-member-form">
                    <input type="text" id="new-team-member" placeholder="Nom du membre">
                    <button class="btn-add-member" id="btn-add-team-member">‚ûï</button>
                </div>
            </div>
            <div class="modal-footer"><div style="flex:1"></div><button class="btn-cancel" id="team-modal-done">Termin√©</button></div>
        </div>
    </div>
    
    <div class="modal-overlay" id="github-modal-overlay">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header"><h2>üîê Connexion GitHub</h2><button class="modal-close" id="github-modal-close">√ó</button></div>
            <div class="modal-body">
                <p style="margin-bottom:1rem;color:#555;background:#e8f4fc;padding:1rem;border-radius:8px;">üìñ <strong>Mode lecture</strong> : vous pouvez consulter les donn√©es.<br>üîê <strong>Pour modifier</strong>, entrez le jeton fourni par Michel.</p>
                <div class="form-group"><label for="github-token">Jeton d'acc√®s</label><input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx"></div>
            </div>
            <div class="modal-footer"><button class="btn-action btn-save" id="github-save-config" style="background: #27ae60; width:100%;">‚úÖ Valider</button></div>
        </div>
    </div>
    
    <div class="sync-indicator" id="sync-indicator"><span id="sync-icon">üîÑ</span><span id="sync-text">Sync...</span></div>
    
    <div class="floating-buttons">
        <a href="aide.html" class="float-btn help-btn" title="Aide">‚ùì</a>
        <a href="timeline.html" class="float-btn" style="background: var(--bleu-clair); color: white;" title="Timeline compl√®te">üìÖ</a>
        <a href="https://wa.me/33637216008" target="_blank" class="float-btn whatsapp-float" title="Support WhatsApp">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/></svg>
        </a>
    </div>

    <script>
        // Config
        const GITHUB_REPO = 'mich59139/suivi';
        const GITHUB_FILE = 'data/communication.json';
        const GITHUB_TEAM_FILE = 'data/equipe.json';
        const GITHUB_BRANCH = 'main';
        
        const axeConfig = {
            'Site web': { icon: 'üåê', class: 'siteweb' },
            'R√©seaux sociaux': { icon: 'üì±', class: 'reseaux' },
            'Supports papier': { icon: 'üìÑ', class: 'papier' },
            '√âv√©nementiel': { icon: 'üéâ', class: 'evenementiel' },
            'Production': { icon: 'üé¨', class: 'production' },
            'Presse': { icon: 'üì∞', class: 'presse' },
            'Email': { icon: '‚úâÔ∏è', class: 'email' }
        };
        
        const typeConfig = {
            'evenement': { icon: 'üéâ', label: '√âv√©nement', color: '#1abc9c' },
            'production': { icon: 'üé¨', label: 'Production', color: '#e67e22' },
            'publication': { icon: 'üì±', label: 'Publication', color: '#9b59b6' },
            'siteweb': { icon: 'üåê', label: 'Site web', color: '#3498db' },
            'terrain': { icon: 'üö∂', label: 'Terrain', color: '#27ae60' },
            'papier': { icon: 'üìÑ', label: 'Papier', color: '#e74c3c' },
            'presse': { icon: 'üì∞', label: 'Presse', color: '#34495e' },
            'email': { icon: '‚úâÔ∏è', label: 'Email', color: '#c0392b' }
        };
        
        const defaultTeam = ["Michel", "Laurent", "Catherine", "Ignazio", "√âquipe"];
        const defaultCategories = ["Infrastructure", "D√©veloppement", "Contenu", "Organisation", "Cr√©ation", "Vid√©o", "Publication FB", "Terrain"];
        
        let actions = [];
        let team = JSON.parse(localStorage.getItem('vizille_team')) || defaultTeam;
        let categories = defaultCategories;
        let filteredActions = [];
        let currentView = 'grouped';
        let editingId = null;
        let githubSha = null, githubTeamSha = null;
        let collapsedAxes = new Set();
        
        // D√©terminer le TYPE d'une t√¢che
        function getTaskType(task) {
            const axe = task.axe || '';
            const categorie = (task.categorie || '').toLowerCase();
            const tache = (task.tache || '').toLowerCase();
            
            if (axe === '√âv√©nementiel' || tache.includes('r√©union') || tache.includes('march√©') || tache.includes('√©v√©nement')) return 'evenement';
            if (axe === 'Production' || categorie === 'vid√©o' || tache.includes('tournage') || tache.includes('montage')) return 'production';
            if (categorie.includes('publication') || categorie.includes('fb') || tache.includes('vid√©o') && !tache.includes('tournage') && !tache.includes('montage')) return 'publication';
            if (axe === 'Site web') return 'siteweb';
            if (categorie === 'terrain' || tache.includes('distribution')) return 'terrain';
            if (axe === 'Supports papier') return 'papier';
            if (axe === 'Presse') return 'presse';
            if (axe === 'Email') return 'email';
            if (axe === 'R√©seaux sociaux') return 'publication';
            return 'production';
        }
        
        // GitHub
        function getGithubToken() { return localStorage.getItem('github_token') || ''; }
        function setGithubToken(token) { token ? localStorage.setItem('github_token', token) : localStorage.removeItem('github_token'); updateGithubStatus(); }
        function isGithubConnected() { return !!getGithubToken(); }
        function updateGithubStatus() { const btn = document.getElementById('btn-github'); const status = document.getElementById('github-status'); if (isGithubConnected()) { btn.classList.add('connected'); status.textContent = '‚úì GitHub'; } else { btn.classList.remove('connected'); status.textContent = 'GitHub'; } }
        function showSyncIndicator(message, type = 'info') { const indicator = document.getElementById('sync-indicator'); indicator.className = 'sync-indicator show ' + type; document.getElementById('sync-icon').textContent = type === 'success' ? '‚úì' : type === 'error' ? '‚úó' : type === 'warning' ? 'üëÅÔ∏è' : 'üîÑ'; document.getElementById('sync-text').textContent = message; setTimeout(() => indicator.classList.remove('show'), 3000); }
        function decodeBase64UTF8(base64) { try { const bin = atob(base64); const bytes = new Uint8Array(bin.length); for (let i = 0; i < bin.length; i++) bytes[i] = bin.charCodeAt(i); return new TextDecoder('utf-8').decode(bytes); } catch (e) { return atob(base64); } }
        function encodeBase64UTF8(str) { const bytes = new TextEncoder().encode(str); let bin = ''; for (let i = 0; i < bytes.length; i++) bin += String.fromCharCode(bytes[i]); return btoa(bin); }
        
        async function loadPublic() { try { showSyncIndicator('Chargement...'); const base = `https://raw.githubusercontent.com/${GITHUB_REPO}/${GITHUB_BRANCH}`; let r = await fetch(`${base}/${GITHUB_FILE}`); if (r.ok) { actions = await r.json(); localStorage.setItem('vizille_actions', JSON.stringify(actions)); } r = await fetch(`${base}/${GITHUB_TEAM_FILE}`); if (r.ok) { team = await r.json(); localStorage.setItem('vizille_team', JSON.stringify(team)); } showSyncIndicator('Lecture seule', 'warning'); return true; } catch (e) { actions = JSON.parse(localStorage.getItem('vizille_actions')) || []; return false; } }
        
        async function loadFromGitHub() { const token = getGithubToken(); if (!token) return false; try { showSyncIndicator('Chargement...'); let r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_FILE}`, { headers: { 'Authorization': `token ${token}` } }); if (r.ok) { const d = await r.json(); githubSha = d.sha; actions = JSON.parse(decodeBase64UTF8(d.content)); localStorage.setItem('vizille_actions', JSON.stringify(actions)); } r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${GITHUB_TEAM_FILE}`, { headers: { 'Authorization': `token ${token}` } }); if (r.ok) { const d = await r.json(); githubTeamSha = d.sha; team = JSON.parse(decodeBase64UTF8(d.content)); localStorage.setItem('vizille_team', JSON.stringify(team)); } showSyncIndicator('Sync ‚úì', 'success'); return true; } catch (e) { showSyncIndicator('Erreur', 'error'); return false; } }
        
        async function saveToGitHub(file, data, sha) { const token = getGithubToken(); if (!token) return null; try { if (!sha) { const r = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${file}`, { headers: { 'Authorization': `token ${token}` } }); if (r.ok) sha = (await r.json()).sha; } const body = { message: `MAJ ${file.split('/').pop()}`, content: encodeBase64UTF8(JSON.stringify(data, null, 2)), branch: GITHUB_BRANCH }; if (sha) body.sha = sha; const response = await fetch(`https://api.github.com/repos/${GITHUB_REPO}/contents/${file}`, { method: 'PUT', headers: { 'Authorization': `token ${token}`, 'Content-Type': 'application/json' }, body: JSON.stringify(body) }); if (response.ok) return (await response.json()).content.sha; return null; } catch (e) { return null; } }
        
        async function saveData() { localStorage.setItem('vizille_actions', JSON.stringify(actions)); if (isGithubConnected()) { githubSha = await saveToGitHub(GITHUB_FILE, actions, githubSha); showSyncIndicator('Sync ‚úì', 'success'); } }
        
        // Helpers
        function getStatutClass(s) { return { '√Ä faire': 'afaire', 'En cours': 'encours', 'Bloqu√©': 'bloque', 'Fait': 'fait' }[s] || 'afaire'; }
        function getNextId() { const nums = actions.map(a => parseInt(a.id.replace('COM-', ''))).filter(n => !isNaN(n)); return `COM-${String((nums.length ? Math.max(...nums) : 0) + 1).padStart(3, '0')}`; }
        
        // Team
        function renderTeamList() { const list = document.getElementById('team-list'); document.getElementById('team-count').textContent = team.length; list.innerHTML = team.map((t, i) => `<li class="member-item"><div class="member-info"><div class="member-name">${t}</div></div><button class="btn-remove-member" data-index="${i}">‚úï</button></li>`).join(''); list.querySelectorAll('.btn-remove-member').forEach(btn => btn.addEventListener('click', () => removeTeamMember(parseInt(btn.dataset.index)))); }
        function addTeamMember() { const name = document.getElementById('new-team-member').value.trim(); if (!name || team.includes(name)) return; team.push(name); localStorage.setItem('vizille_team', JSON.stringify(team)); if (isGithubConnected()) saveToGitHub(GITHUB_TEAM_FILE, team, githubTeamSha).then(sha => githubTeamSha = sha); document.getElementById('new-team-member').value = ''; renderTeamList(); updateResponsableSelects(); }
        function removeTeamMember(i) { team.splice(i, 1); localStorage.setItem('vizille_team', JSON.stringify(team)); if (isGithubConnected()) saveToGitHub(GITHUB_TEAM_FILE, team, githubTeamSha).then(sha => githubTeamSha = sha); renderTeamList(); updateResponsableSelects(); }
        function updateResponsableSelects() { const opts = team.map(t => `<option value="${t}">${t}</option>`).join(''); document.getElementById('form-responsable').innerHTML = opts; document.getElementById('filter-responsable').innerHTML = '<option value="">Tous</option>' + opts; }
        function updateCategoriesSelect() { document.getElementById('form-categorie').innerHTML = categories.map(c => `<option value="${c}">${c}</option>`).join(''); }
        
        // Chart
        let statusChart = null;
        function updateChart() { const c = { afaire: actions.filter(a => a.statut === '√Ä faire').length, encours: actions.filter(a => a.statut === 'En cours').length, bloque: actions.filter(a => a.statut === 'Bloqu√©').length, fait: actions.filter(a => a.statut === 'Fait').length }; const ctx = document.getElementById('statusChart').getContext('2d'); if (statusChart) statusChart.destroy(); statusChart = new Chart(ctx, { type: 'doughnut', data: { labels: ['√Ä faire', 'En cours', 'Bloqu√©', 'Fait'], datasets: [{ data: [c.afaire, c.encours, c.bloque, c.fait], backgroundColor: ['#3498db', '#f39c12', '#e74c3c', '#27ae60'], borderWidth: 0 }] }, options: { responsive: true, cutout: '60%', plugins: { legend: { display: false } } } }); document.getElementById('chart-legend').innerHTML = [{ l: '√Ä faire', v: c.afaire, c: '#3498db' }, { l: 'En cours', v: c.encours, c: '#f39c12' }, { l: 'Bloqu√©', v: c.bloque, c: '#e74c3c' }, { l: 'Fait', v: c.fait, c: '#27ae60' }].map(i => `<div class="legend-item" data-filter="${i.l}"><div class="legend-color" style="background:${i.c}"></div><span class="legend-label">${i.l}</span><span class="legend-value">${i.v}</span></div>`).join(''); }
        
        function updateStats() { const t = actions.length, af = actions.filter(a => a.statut === '√Ä faire').length, ec = actions.filter(a => a.statut === 'En cours').length, bl = actions.filter(a => a.statut === 'Bloqu√©').length, fa = actions.filter(a => a.statut === 'Fait').length, ha = actions.filter(a => a.priorite === 'Haute').length; document.getElementById('stats-bar').innerHTML = `<div class="stat-chip" data-filter="all"><span class="stat-number">${t}</span><span>Total</span></div><div class="stat-chip afaire" data-filter="√Ä faire"><span class="stat-number">${af}</span><span>√Ä faire</span></div><div class="stat-chip encours" data-filter="En cours"><span class="stat-number">${ec}</span><span>En cours</span></div><div class="stat-chip bloque" data-filter="Bloqu√©"><span class="stat-number">${bl}</span><span>Bloqu√©</span></div><div class="stat-chip fait" data-filter="Fait"><span class="stat-number">${fa}</span><span>Fait</span></div><div class="stat-chip haute" data-filter="Haute"><span class="stat-number">${ha}</span><span>Haute</span></div>`; document.querySelectorAll('.stat-chip').forEach(chip => chip.addEventListener('click', () => { const f = chip.dataset.filter; document.querySelectorAll('.stat-chip').forEach(c => c.classList.remove('active')); filteredActions = f === 'all' ? [...actions] : f === 'Haute' ? actions.filter(a => a.priorite === 'Haute') : actions.filter(a => a.statut === f); if (f !== 'all') chip.classList.add('active'); renderView(); })); }
        
        // Filters
        function applyFilters() { const s = document.getElementById('search-input').value.toLowerCase(); const r = document.getElementById('filter-responsable').value; const st = document.getElementById('filter-statut').value; filteredActions = actions.filter(a => (!s || a.tache.toLowerCase().includes(s) || a.id.toLowerCase().includes(s) || (a.description || '').toLowerCase().includes(s)) && (!r || a.responsable === r) && (!st || a.statut === st)); document.querySelectorAll('.stat-chip').forEach(c => c.classList.remove('active')); renderView(); }

        // ===== RENDER CARD =====
        function renderCard(a) {
            const type = getTaskType(a);
            const isUrgent = a.echeance && new Date(a.echeance) < new Date();
            const typeInfo = typeConfig[type] || { icon: 'üìå', label: type };
            return `
                <div class="action-card type-${type}" data-id="${a.id}">
                    <div class="card-header">
                        <span class="card-id">${a.id}</span>
                        <div class="card-badges">
                            <span class="badge badge-statut ${getStatutClass(a.statut)}">${a.statut}</span>
                            ${a.priorite === 'Haute' ? '<span class="badge badge-priorite">‚ö°</span>' : ''}
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="card-title">${a.tache}</div>
                        <div class="card-description">${a.description || ''}</div>
                    </div>
                    <div class="card-footer">
                        <div class="card-meta"><span>üë§</span><span>${a.responsable}</span></div>
                        ${a.echeance ? `<span class="card-echeance ${isUrgent ? 'urgent' : ''}">üìÖ ${new Date(a.echeance).toLocaleDateString('fr-FR')}</span>` : ''}
                    </div>
                </div>
            `;
        }
        
        // ===== VUE 1: PAR AXE =====
        function renderGrouped() {
            const container = document.getElementById('grouped-container');
            const grouped = {};
            filteredActions.forEach(a => { if (!grouped[a.axe]) grouped[a.axe] = []; grouped[a.axe].push(a); });
            const axeOrder = ['Site web', 'R√©seaux sociaux', 'Supports papier', '√âv√©nementiel', 'Production', 'Presse', 'Email'];
            
            let html = '';
            axeOrder.forEach(axe => {
                const items = grouped[axe];
                if (!items || items.length === 0) return;
                const config = axeConfig[axe] || { icon: 'üìå', class: 'siteweb' };
                const isCollapsed = collapsedAxes.has(axe);
                const stats = { afaire: items.filter(a => a.statut === '√Ä faire').length, encours: items.filter(a => a.statut === 'En cours').length, fait: items.filter(a => a.statut === 'Fait').length, bloque: items.filter(a => a.statut === 'Bloqu√©').length };
                
                html += `<div class="axe-group ${isCollapsed ? 'collapsed' : ''}" data-axe="${axe}">
                    <div class="axe-header ${config.class}">
                        <div class="axe-title"><span class="axe-icon">${config.icon}</span><span class="axe-name">${axe}</span><span class="axe-count">${items.length}</span></div>
                        <div class="axe-stats">
                            ${stats.afaire > 0 ? `<div class="axe-stat"><span class="axe-stat-dot afaire"></span>${stats.afaire}</div>` : ''}
                            ${stats.encours > 0 ? `<div class="axe-stat"><span class="axe-stat-dot encours"></span>${stats.encours}</div>` : ''}
                            ${stats.fait > 0 ? `<div class="axe-stat"><span class="axe-stat-dot fait"></span>${stats.fait}</div>` : ''}
                        </div>
                        <span class="axe-toggle">‚ñº</span>
                    </div>
                    <div class="axe-content">${items.map(a => renderCard(a)).join('')}</div>
                </div>`;
            });
            container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>Aucune action</h3></div>';
            addCardListeners(container);
            addAxeListeners(container);
        }
        
        // ===== VUE 2: PAR TYPE =====
        function renderTypes() {
            const container = document.getElementById('types-container');
            const grouped = {};
            filteredActions.forEach(a => { const type = getTaskType(a); if (!grouped[type]) grouped[type] = []; grouped[type].push(a); });
            const typeOrder = ['evenement', 'production', 'publication', 'terrain', 'siteweb', 'papier', 'presse', 'email'];
            
            let html = '';
            typeOrder.forEach(type => {
                const items = grouped[type];
                if (!items || items.length === 0) return;
                const config = typeConfig[type] || { icon: 'üìå', label: type, color: '#999' };
                const isCollapsed = collapsedAxes.has('type_' + type);
                const stats = { afaire: items.filter(a => a.statut === '√Ä faire').length, encours: items.filter(a => a.statut === 'En cours').length, fait: items.filter(a => a.statut === 'Fait').length };
                
                html += `<div class="axe-group ${isCollapsed ? 'collapsed' : ''}" data-axe="type_${type}">
                    <div class="axe-header" style="background: linear-gradient(135deg, ${config.color} 0%, ${config.color}dd 100%);">
                        <div class="axe-title"><span class="axe-icon">${config.icon}</span><span class="axe-name">${config.label}</span><span class="axe-count">${items.length}</span></div>
                        <div class="axe-stats">
                            ${stats.afaire > 0 ? `<div class="axe-stat"><span class="axe-stat-dot afaire"></span>${stats.afaire}</div>` : ''}
                            ${stats.encours > 0 ? `<div class="axe-stat"><span class="axe-stat-dot encours"></span>${stats.encours}</div>` : ''}
                            ${stats.fait > 0 ? `<div class="axe-stat"><span class="axe-stat-dot fait"></span>${stats.fait}</div>` : ''}
                        </div>
                        <span class="axe-toggle">‚ñº</span>
                    </div>
                    <div class="axe-content">${items.map(a => renderCard(a)).join('')}</div>
                </div>`;
            });
            container.innerHTML = html || '<div class="empty-state"><div class="empty-state-icon">üì≠</div><h3>Aucune action</h3></div>';
            addCardListeners(container);
            addAxeListeners(container);
        }
        
        // ===== VUE 3: KANBAN =====
        function renderKanban() {
            const container = document.getElementById('kanban-container');
            const statuts = ['√Ä faire', 'En cours', 'Bloqu√©', 'Fait'];
            
            let html = '<div class="kanban-container">';
            statuts.forEach(statut => {
                const items = filteredActions.filter(a => a.statut === statut);
                const cls = getStatutClass(statut);
                html += `<div class="kanban-column">
                    <div class="kanban-header ${cls}">${statut}<span class="count">${items.length}</span></div>
                    <div class="kanban-body">
                        ${items.map(a => {
                            const type = getTaskType(a);
                            const typeInfo = typeConfig[type] || { icon: 'üìå' };
                            return `<div class="kanban-card type-${type}" data-id="${a.id}">
                                <div class="kanban-card-title">${typeInfo.icon} ${a.tache}</div>
                                <div class="kanban-card-meta"><span>üë§ ${a.responsable}</span><span>${a.echeance ? new Date(a.echeance).toLocaleDateString('fr-FR') : ''}</span></div>
                            </div>`;
                        }).join('')}
                    </div>
                </div>`;
            });
            html += '</div>';
            container.innerHTML = html;
            addCardListeners(container, '.kanban-card');
        }
        
        // ===== VUE 4: TIMELINE =====
        function renderTimeline() {
            const container = document.getElementById('timeline-container');
            
            // G√©n√©rer les semaines
            const weeks = [];
            const start = new Date('2026-01-12');
            const end = new Date('2026-03-22');
            let current = new Date(start);
            while (current <= end) {
                const weekStart = new Date(current);
                const weekEnd = new Date(current);
                weekEnd.setDate(weekEnd.getDate() + 6);
                weeks.push({ start: weekStart, end: weekEnd, label: `Semaine ${weeks.length + 1}`, dates: `${weekStart.getDate()}/${weekStart.getMonth()+1} - ${weekEnd.getDate()}/${weekEnd.getMonth()+1}` });
                current.setDate(current.getDate() + 7);
            }
            
            let html = '<div class="timeline-mini">';
            weeks.forEach(week => {
                const weekTasks = filteredActions.filter(a => {
                    if (!a.echeance) return false;
                    const d = new Date(a.echeance);
                    return d >= week.start && d <= week.end;
                });
                if (weekTasks.length === 0) return;
                
                html += `<div class="timeline-week">
                    <div class="timeline-week-header">
                        <span class="timeline-week-label">${week.label}</span>
                        <span class="timeline-week-dates">${week.dates}</span>
                    </div>
                    <div class="timeline-tasks">
                        ${weekTasks.map(a => {
                            const type = getTaskType(a);
                            const typeInfo = typeConfig[type] || { icon: 'üìå' };
                            const isFait = a.statut === 'Fait';
                            return `<div class="timeline-task ${type} ${isFait ? 'fait' : ''}" data-id="${a.id}">${typeInfo.icon} ${a.tache}</div>`;
                        }).join('')}
                    </div>
                </div>`;
            });
            html += '<p style="text-align:center;margin-top:1rem;"><a href="timeline.html" style="color:var(--bleu-vizille);">üìÖ Voir la timeline compl√®te ‚Üí</a></p></div>';
            container.innerHTML = html;
            addCardListeners(container, '.timeline-task');
        }
        
        // Event listeners
        function addCardListeners(container, selector = '.action-card') {
            container.querySelectorAll(selector).forEach(card => {
                card.addEventListener('click', (e) => {
                    e.stopPropagation();
                    if (!isGithubConnected()) { document.getElementById('github-modal-overlay').classList.add('active'); return; }
                    openModal(card.dataset.id);
                });
            });
        }
        
        function addAxeListeners(container) {
            container.querySelectorAll('.axe-header').forEach(header => {
                header.addEventListener('click', () => {
                    const group = header.closest('.axe-group');
                    const axe = group.dataset.axe;
                    group.classList.toggle('collapsed');
                    if (group.classList.contains('collapsed')) collapsedAxes.add(axe);
                    else collapsedAxes.delete(axe);
                });
            });
        }
        
        // Main render
        function renderView() {
            document.querySelectorAll('.view-container').forEach(c => c.classList.remove('active'));
            if (currentView === 'grouped') { document.getElementById('grouped-container').classList.add('active'); renderGrouped(); }
            else if (currentView === 'types') { document.getElementById('types-container').classList.add('active'); renderTypes(); }
            else if (currentView === 'kanban') { document.getElementById('kanban-container').classList.add('active'); renderKanban(); }
            else if (currentView === 'timeline') { document.getElementById('timeline-container').classList.add('active'); renderTimeline(); }
        }

        // Modal
        function openModal(id = null) {
            editingId = id;
            updateResponsableSelects();
            updateCategoriesSelect();
            if (id) {
                const a = actions.find(x => x.id === id);
                if (!a) return;
                document.getElementById('modal-icon').textContent = 'üìù';
                document.getElementById('modal-title').textContent = a.id;
                document.getElementById('form-id').value = a.id;
                document.getElementById('form-axe').value = a.axe || 'Site web';
                document.getElementById('form-categorie').value = a.categorie || categories[0];
                document.getElementById('form-tache').value = a.tache;
                document.getElementById('form-description').value = a.description || '';
                document.getElementById('form-responsable').value = a.responsable;
                document.getElementById('form-statut').value = a.statut;
                document.getElementById('form-priorite').value = a.priorite;
                document.getElementById('form-echeance').value = a.echeance || '';
                document.getElementById('btn-delete').style.display = 'flex';
            } else {
                document.getElementById('modal-icon').textContent = '‚ûï';
                document.getElementById('modal-title').textContent = 'Nouvelle action';
                document.getElementById('form-id').value = getNextId();
                document.getElementById('form-axe').value = 'Site web';
                document.getElementById('form-categorie').value = categories[0];
                document.getElementById('form-tache').value = '';
                document.getElementById('form-description').value = '';
                document.getElementById('form-responsable').value = team[0] || '';
                document.getElementById('form-statut').value = '√Ä faire';
                document.getElementById('form-priorite').value = 'Moyenne';
                document.getElementById('form-echeance').value = '';
                document.getElementById('btn-delete').style.display = 'none';
            }
            document.getElementById('modal-overlay').classList.add('active');
        }
        
        function closeModal() { document.getElementById('modal-overlay').classList.remove('active'); editingId = null; }
        
        function saveAction() {
            const d = {
                id: document.getElementById('form-id').value,
                axe: document.getElementById('form-axe').value,
                categorie: document.getElementById('form-categorie').value,
                tache: document.getElementById('form-tache').value,
                description: document.getElementById('form-description').value,
                responsable: document.getElementById('form-responsable').value,
                statut: document.getElementById('form-statut').value,
                priorite: document.getElementById('form-priorite').value,
                echeance: document.getElementById('form-echeance').value
            };
            if (!d.tache.trim()) return;
            if (editingId) { const i = actions.findIndex(a => a.id === editingId); if (i !== -1) actions[i] = d; }
            else actions.push(d);
            saveData();
            updateStats(); updateChart(); applyFilters();
            closeModal();
        }
        
        function deleteAction() {
            if (!editingId || !confirm('Supprimer cette action ?')) return;
            actions = actions.filter(a => a.id !== editingId);
            saveData();
            updateStats(); updateChart(); applyFilters();
            closeModal();
        }
        
        // Export CSV
        function exportData() {
            const BOM = '\uFEFF';
            const h = ['ID', 'Axe', 'Cat√©gorie', 'T√¢che', 'Description', 'Responsable', 'Statut', 'Priorit√©', '√âch√©ance'];
            const csv = BOM + h.join(';') + '\n' + actions.map(a => 
                [a.id, a.axe, a.categorie || '', a.tache, (a.description || '').replace(/[\n\r;]/g, ' '), a.responsable, a.statut, a.priorite, a.echeance || '']
                .map(v => `"${(v || '').replace(/"/g, '""')}"`)
                .join(';')
            ).join('\n');
            const el = document.createElement('a');
            el.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
            el.download = `suivi-${new Date().toISOString().split('T')[0]}.csv`;
            el.click();
        }
        
        function closeAllModals() {
            ['modal-overlay', 'team-modal-overlay', 'github-modal-overlay'].forEach(id => 
                document.getElementById(id).classList.remove('active')
            );
        }
        
        // Init
        async function init() {
            updateGithubStatus();
            if (isGithubConnected()) { await loadFromGitHub(); } else { await loadPublic(); }
            filteredActions = [...actions];
            updateResponsableSelects();
            updateCategoriesSelect();
            updateStats();
            updateChart();
            renderView();
            
            // Event listeners
            document.getElementById('search-input').addEventListener('input', applyFilters);
            document.getElementById('filter-responsable').addEventListener('change', applyFilters);
            document.getElementById('filter-statut').addEventListener('change', applyFilters);
            
            document.querySelectorAll('.view-btn').forEach(b => b.addEventListener('click', () => {
                document.querySelectorAll('.view-btn').forEach(x => x.classList.remove('active'));
                b.classList.add('active');
                currentView = b.dataset.view;
                renderView();
            }));
            
            document.getElementById('btn-new').addEventListener('click', () => { if (!isGithubConnected()) { document.getElementById('github-modal-overlay').classList.add('active'); return; } openModal(); });
            document.getElementById('btn-export').addEventListener('click', exportData);
            document.getElementById('modal-close').addEventListener('click', closeModal);
            document.getElementById('btn-cancel').addEventListener('click', closeModal);
            document.getElementById('btn-save').addEventListener('click', saveAction);
            document.getElementById('btn-delete').addEventListener('click', deleteAction);
            document.getElementById('modal-overlay').addEventListener('click', e => { if (e.target.id === 'modal-overlay') closeModal(); });
            
            document.getElementById('btn-team').addEventListener('click', () => { renderTeamList(); document.getElementById('team-modal-overlay').classList.add('active'); });
            document.getElementById('team-modal-close').addEventListener('click', () => document.getElementById('team-modal-overlay').classList.remove('active'));
            document.getElementById('team-modal-done').addEventListener('click', () => document.getElementById('team-modal-overlay').classList.remove('active'));
            document.getElementById('btn-add-team-member').addEventListener('click', addTeamMember);
            document.getElementById('new-team-member').addEventListener('keypress', e => { if (e.key === 'Enter') addTeamMember(); });
            
            document.getElementById('btn-github').addEventListener('click', () => { document.getElementById('github-token').value = getGithubToken(); document.getElementById('github-modal-overlay').classList.add('active'); });
            document.getElementById('github-modal-close').addEventListener('click', () => document.getElementById('github-modal-overlay').classList.remove('active'));
            document.getElementById('github-save-config').addEventListener('click', async () => { setGithubToken(document.getElementById('github-token').value); document.getElementById('github-modal-overlay').classList.remove('active'); await loadFromGitHub(); filteredActions = [...actions]; updateStats(); updateChart(); renderView(); updateGithubStatus(); });
            
            document.addEventListener('keydown', e => { if (e.key === 'Escape') closeAllModals(); });
        }
        
        init();
    </script>
</body>
</html>
